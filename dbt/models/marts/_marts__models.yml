version: 2

models:
  - name: dim_users
    description: "Master user dimension table - one row per user"
    columns:
      - name: user_address
        description: "Primary key"
        tests:
          - unique
          - not_null
      - name: cohort_month
        tests:
          - not_null
      - name: user_segment
        tests:
          - accepted_values:
              arguments:
                values: ['Whale', 'Retail']
      - name: is_churned
        tests:
          - not_null
      - name: engagement_status
        tests:
          - accepted_values:
              arguments:
                values: ['High Value Retained', 'Retained', 'Engaged', 'Bridge Only', 'Unknown']

  - name: fct_cohort_retention
    description: "Cohort retention matrix - the main deliverable"
    tests:
      - unique:
          column_name: "cohort_month || '-' || user_segment || '-' || months_since_bridge"
    columns:
      - name: cohort_month
        tests:
          - not_null
      - name: user_segment
        tests:
          - not_null
      - name: months_since_bridge
        tests:
          - not_null
      - name: cohort_size
        tests:
          - not_null
      - name: active_users
        tests:
          - not_null
      - name: retention_rate
        tests:
          - not_null

  - name: mart_wallet_trading_sessions
    description: "Wallet trading session analysis - classifies users by when they trade (Asian/European/American sessions)"
    columns:
      - name: user_address
        description: "Primary key - wallet address"
        tests:
          - unique
          - not_null
      - name: dominant_session
        description: "Trading session with most transactions"
        tests:
          - not_null
          - accepted_values:
              values: ['asian', 'european', 'american', 'peak_overlap', 'off_hours']
      - name: total_tx_count
        tests:
          - not_null
